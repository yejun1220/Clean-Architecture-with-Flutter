import 'package:clean_architecture/data/data_source/pixabay_api.dart';
import 'package:clean_architecture/data/data_source/result.dart';
import 'package:clean_architecture/data/repository/photo_api_repository_impl.dart';
import 'package:clean_architecture/domain/model/photo.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/annotations.dart';
import 'package:http/http.dart' as http;
import 'package:mockito/mockito.dart';

import 'pixabay_api_test.mocks.dart';

@GenerateMocks([http.Client])
void main() {
  test("Pixabay Api가 잘 작동해야한다.", () async {
    final client = MockClient();
    final api = PhotoApiRepositoryImpl(PixabayApi(client));

    // mock 객체의 행동을 지정해주는 함수
    when(client.get(Uri.parse('${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=apple&image_type=photo')))
        .thenAnswer((_) async => http.Response(fakeJsonBody, 200));

    final Result<List<Photo>> result = await api.fetch("apple");

    expect((result as Success<List<Photo>>).data.first.id, 634572);

    // 실제 동작했는지 확인해주는 함수
    verify(client.get(Uri.parse('${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=apple&image_type=photo')));
  });
}

String fakeJsonBody = """
{"total":8749,"totalHits":500,"hits":[{"id":634572,"pageURL":"https://pixabay.com/photos/apples-fruits-red-ripe-vitamins-634572/","type":"photo","tags":"apples, fruits, red","previewURL":"https://cdn.pixabay.com/photo/2015/02/13/00/43/apples-634572_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g0487cf1ebc886f9fc906a259ab3cad79c08bf453c607ff5a6f80b12594cbe5ffb420926e70ceb1aa26d4bd16506812c6_640.jpg","webformatWidth":427,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gfb8813c309da8392184fbb85e06b669182c096658d50f83bf9b2df7d94cca815c15321f113ccba9f8caeba24a1e9e8f793ef7ae9a2501e98058da634a65aa3f1_1280.jpg","imageWidth":3345,"imageHeight":5017,"imageSize":811238,"views":409702,"downloads":235033,"collections":2948,"likes":2295,"comments":180,"user_id":752536,"user":"Desertrose7","userImageURL":"https://cdn.pixabay.com/user/2016/03/14/13-25-18-933_250x250.jpg"},{"id":4352072,"pageURL":"https://pixabay.com/photos/new-york-usa-nyc-ny-manhattan-4352072/","type":"photo","tags":"new york, usa, nyc","previewURL":"https://cdn.pixabay.com/photo/2019/07/21/07/12/new-york-4352072_150.jpg","previewWidth":150,"previewHeight":90,"webformatURL":"https://pixabay.com/get/ge3165ad6640a5a39002c9c9137eaa7abf235db49253c76b43fda5a4e81ba54e53430ca9ec1344c0dd56d653c593b89f660f808f336252b7525a59a5383c2fdda_640.jpg","webformatWidth":640,"webformatHeight":385,"largeImageURL":"https://pixabay.com/get/g9409db160a7e800ea6b77f9a73d2522b5214756490c8cb1521c4f20877d286166ba8876cef10322c76c0bddc6b32da818c7738037cc307abf77a67cd2fff4d88_1280.jpg","imageWidth":5000,"imageHeight":3010,"imageSize":3526990,"views":112589,"downloads":89197,"collections":3028,"likes":183,"comments":34,"user_id":1131094,"user":"Leonhard_Niederwimmer","userImageURL":"https://cdn.pixabay.com/user/2020/05/13/18-42-49-177_250x250.jpg"},{"id":2788662,"pageURL":"https://pixabay.com/photos/apple-red-hand-apple-plantation-2788662/","type":"photo","tags":"apple, red, hand","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/42/apple-2788662_150.jpg","previewWidth":150,"previewHeight":88,"webformatURL":"https://pixabay.com/get/gec47e9610c1af007f94b1d02ea5f61150936a9431d2a235bddf7381472e43ee8077bbca25ebba49a6a5d166f1cee7df0c9f702c10d0468a9c46a0c7eb517976e_640.jpg","webformatWidth":640,"webformatHeight":377,"largeImageURL":"https://pixabay.com/get/g92238d709dc26a3cd9721490c2b74cee616b991e937347df1defb3f8392cc41bd13d0e47247f940e8b74108718b7aa76ed0af76d51442a9a201b8e9ddb5b39ef_1280.jpg","imageWidth":6000,"imageHeight":3539,"imageSize":2042422,"views":135972,"downloads":78009,"collections":2174,"likes":578,"comments":83,"user_id":2364555,"user":"pixel2013","userImageURL":"https://cdn.pixabay.com/user/2020/07/25/21-10-11-80_250x250.jpg"},{"id":1868496,"pageURL":"https://pixabay.com/photos/apple-computer-desk-workspace-1868496/","type":"photo","tags":"apple, computer, desk","previewURL":"https://cdn.pixabay.com/photo/2016/11/29/08/41/apple-1868496_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gcae5156d4045f258bc3f1c4182bb1ec3c5d986b54c335cb2d9254301a8fea5ffd95e7a69519dce2f80535126922e1406774424247621097b395743bbe9a1c689_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g773e1304e5a8b351f95b8c54ccce621da9a2bf3a546427738cb403a5a752fa1d004996626753107cd801b301fb24c45c8fe0e6bee59ab06cb83e6aafdd743a8b_1280.jpg","imageWidth":5184,"imageHeight":3456,"imageSize":2735519,"views":586736,"downloads":430386,"collections":1289,"likes":949,"comments":255,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":581131,"pageURL":"https://pixabay.com/photos/office-home-office-creative-apple-581131/","type":"photo","tags":"office, home office, creative","previewURL":"https://cdn.pixabay.com/photo/2014/12/27/15/40/office-581131_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g740939e4553f32434d25f64116a55fb9d6d0a67456101af099e8a057c407ebc3f890093786ddbd84ef99716f165a36d4_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g7e375e7479261489d558500ed380d374fd5eff3dd156ffbef39318b6e60ac49a218713165f4322b898ad08a05f705fdaebe98ccbd2f917de8d4c18958f23084b_1280.jpg","imageWidth":5760,"imageHeight":3840,"imageSize":5987170,"views":315696,"downloads":178762,"collections":1922,"likes":411,"comments":79,"user_id":670330,"user":"markusspiske","userImageURL":"https://cdn.pixabay.com/user/2016/07/06/12-50-00-288_250x250.jpg"},{"id":1873078,"pageURL":"https://pixabay.com/photos/apples-orchard-apple-trees-1873078/","type":"photo","tags":"apples, orchard, apple trees","previewURL":"https://cdn.pixabay.com/photo/2016/11/30/15/23/apples-1873078_150.jpg","previewWidth":150,"previewHeight":95,"webformatURL":"https://pixabay.com/get/gbf9ddd282f5a4139a55cc358a4fcd47c05669b405bc8da95427b7d3dc4b2f91df7e65448a5430561bed6df8b86a1dcc84b4c63166219acfd21981c95b9956645_640.jpg","webformatWidth":640,"webformatHeight":408,"largeImageURL":"https://pixabay.com/get/g395f564274443857e9116d226cfe9df7ba886a7da0770d8b318a0e1321f4ae210afe3da9357967d8260fa6d67f1858bff41e75e2b17cb4b1afd81abf2d3376e7_1280.jpg","imageWidth":3212,"imageHeight":2051,"imageSize":2581012,"views":361391,"downloads":204942,"collections":1034,"likes":1055,"comments":150,"user_id":3890388,"user":"lumix2004","userImageURL":""},{"id":1122537,"pageURL":"https://pixabay.com/photos/apple-water-droplets-fruit-moist-1122537/","type":"photo","tags":"apple, water droplets, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/01/05/13/58/apple-1122537_150.jpg","previewWidth":150,"previewHeight":95,"webformatURL":"https://pixabay.com/get/g4ccbde4d23fd92b30e61fe33ac79d4324d05812efcf7047434440c4441872d0a37f2d26b6449a7c837bf628f7c874368a00aa291232933119a6c9a30212f161f_640.jpg","webformatWidth":640,"webformatHeight":409,"largeImageURL":"https://pixabay.com/get/g434b3f00ce6a918fddf0a32eb9970ab1b1e8afe26ce982fb564e099ce0a3822e5ea79b7618b6ad1afb0a7bc63fe348c840d6554a408e9550c8e31a1105d7418e_1280.jpg","imageWidth":4752,"imageHeight":3044,"imageSize":5213632,"views":270849,"downloads":156447,"collections":975,"likes":1056,"comments":168,"user_id":1445608,"user":"mploscar","userImageURL":"https://cdn.pixabay.com/user/2016/01/05/14-08-20-943_250x250.jpg"},{"id":1004886,"pageURL":"https://pixabay.com/photos/apples-fruits-farm-food-harvest-1004886/","type":"photo","tags":"apples, fruits, farm","previewURL":"https://cdn.pixabay.com/photo/2015/10/24/20/03/apples-1004886_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g8a8196231ded91d5ec5dbaeb2aaff0bfc36ee85affb382208363ec8530899ee8f54b3e441c3462fc05e3dd0706694ce4f554794b085031ee7819904ec88d3c07_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g656a87fbb6f0f4d888b735bf4ca8a1cad9921851f3e8d034b0d6731ae0d831dfca8c7f2f274f343aef07ed0dd732ac75356bcbbd92e4b146248b78adcdf8bab9_1280.jpg","imageWidth":2048,"imageHeight":1365,"imageSize":631692,"views":95725,"downloads":59866,"collections":1797,"likes":307,"comments":32,"user_id":334088,"user":"JillWellington","userImageURL":"https://cdn.pixabay.com/user/2018/06/27/01-23-02-27_250x250.jpg"},{"id":256261,"pageURL":"https://pixabay.com/photos/apple-books-still-life-fruit-food-256261/","type":"photo","tags":"apple, books, still life","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256261_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gf4b83661c3bcc915cdd963042497072bc55956874ac6b0fda43066cb3a048401c2d854f645f606e091eba0a6d137b0de_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g1d1de36573c6b24d8916e956f129815cc83439685cfadc0cabbe355d90c9e27c5c96f676ff578c72664281987570474daa388a4fa78609a24d44a299d9b4bc72_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2987083,"views":445155,"downloads":223087,"collections":891,"likes":912,"comments":233,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":2788651,"pageURL":"https://pixabay.com/photos/apples-apple-tree-fruits-orchard-2788651/","type":"photo","tags":"apples, apple tree, fruits","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/39/apples-2788651_150.jpg","previewWidth":150,"previewHeight":77,"webformatURL":"https://pixabay.com/get/ga9a4c9134bb1ae15d0ed29468d4b031ec9bc8140e56e7502accfdaf45dd563088d55ccb96ebccedb830288a2a15213e9de033ef1d8dae42b6122973b4528d307_640.jpg","webformatWidth":640,"webformatHeight":330,"largeImageURL":"https://pixabay.com/get/g03a6bc6157caa956c45729c6de3a6cbb126bb044e2ff419160f435c8230c8e80e99b6d911d8f9396426107affd5e340795749a6d830985fb03b8da5f0dfed23b_1280.jpg","imageWidth":6000,"imageHeight":3103,"imageSize":2518838,"views":67689,"downloads":41101,"collections":1288,"likes":456,"comments":51,"user_id":2364555,"user":"pixel2013","userImageURL":"https://cdn.pixabay.com/user/2020/07/25/21-10-11-80_250x250.jpg"},{"id":410324,"pageURL":"https://pixabay.com/photos/iphone-smartphone-apps-apple-inc-410324/","type":"photo","tags":"iphone, smartphone, apps","previewURL":"https://cdn.pixabay.com/photo/2014/08/05/10/30/iphone-410324_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g33c0a3a7a7f2199c18d816b0da657cd3caaf8536516b23b6d4dc065c02f2700f3616938eab13847ec5d17a15be38005b_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g89d8f972f9007b22af9dc3f81a08dd9a7442e5b887311543d6348af2516f0b43d23d69a3aa854019aed8f1b213581f81136e80ed78b548d14746c213076c432d_1280.jpg","imageWidth":2180,"imageHeight":1453,"imageSize":477025,"views":692111,"downloads":402325,"collections":865,"likes":776,"comments":205,"user_id":264599,"user":"JESHOOTS-com","userImageURL":"https://cdn.pixabay.com/user/2014/06/08/15-27-10-248_250x250.jpg"},{"id":1894723,"pageURL":"https://pixabay.com/photos/smartphone-cellphone-touchscreen-1894723/","type":"photo","tags":"smartphone, cellphone, touchscreen","previewURL":"https://cdn.pixabay.com/photo/2016/12/09/11/33/smartphone-1894723_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g128d49b67da8120ac643effbf2e3bc638e55d0b9957d7ea92bfd97423024992c3bd805e33301fd0618d40cf28c32ac4e4845506cf5016241bb643242bf7566f2_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/gc3254badc46ce7e615b79d8335b03e18dc36cc0366cef02ffeb3d17e254da15a8a149d430ba4b491f7cdd9956f4dd18565cce3893e4f6a404819821d3e79a127_1280.jpg","imageWidth":5005,"imageHeight":3337,"imageSize":1214266,"views":446080,"downloads":287244,"collections":762,"likes":800,"comments":272,"user_id":282134,"user":"stevepb","userImageURL":"https://cdn.pixabay.com/user/2015/09/15/20-33-27-452_250x250.jpg"},{"id":1867461,"pageURL":"https://pixabay.com/photos/apple-iphone-close-up-smartphone-1867461/","type":"photo","tags":"apple, iphone, close up","previewURL":"https://cdn.pixabay.com/photo/2016/11/29/05/08/apple-1867461_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g658ec66693ae9d1103f8acc3ca2ed77562ef3996e8acdf48a89fe51cc14270ff0ebbec4fd24307432f41bc964958feea792b5d3403f079292743ff4b604987fa_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/g42fd8c08b4f6ed0f0bfda7442ec5dcd7032e63dacefb9220fc96ed5f62e2d9febaa1887f7f5255757b1e353fa8debd04ed2ad2504c8603c0a8a87f98553235e5_1280.jpg","imageWidth":5252,"imageHeight":3507,"imageSize":1410507,"views":66572,"downloads":39334,"collections":1526,"likes":128,"comments":20,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":599475,"pageURL":"https://pixabay.com/photos/home-office-laptop-notebook-startup-599475/","type":"photo","tags":"home office, laptop, notebook","previewURL":"https://cdn.pixabay.com/photo/2015/01/14/18/41/home-office-599475_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g779864111506996d5e7b6e06b1598867f26c030bcffbe821cfab0120c60b57433634d020a3b7b41c788ef44296839a6d_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g3c5b14209df459df8967aa3850d2654910497b43be4f40a0cf9bcc9905a501ba1e10fbf0e19f1a18737b314f7b259e4ae8a8461b25adfe27990041cd4675f3d2_1280.jpg","imageWidth":5760,"imageHeight":3840,"imageSize":5410852,"views":202986,"downloads":113754,"collections":1198,"likes":353,"comments":49,"user_id":670330,"user":"markusspiske","userImageURL":"https://cdn.pixabay.com/user/2016/07/06/12-50-00-288_250x250.jpg"},{"id":1839500,"pageURL":"https://pixabay.com/photos/man-computer-screen-desktop-imac-1839500/","type":"photo","tags":"man, computer, screen","previewURL":"https://cdn.pixabay.com/photo/2016/11/19/14/16/man-1839500_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g5105381a0ef572d6d8632369e0213d3d201d103f78cdaba971b20c3b4fec523777cb83c4ae97c2a88765874edfc09704735e771932d91088dbfd630700ba38fb_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/g349814f37501acc2cdc097d73391e715967083766ba94b197229654022b8d22c3400c1f58e9cc49924d412ba1f743977f9cb263d600539ea0d5bae56ea2be7ad_1280.jpg","imageWidth":6016,"imageHeight":4016,"imageSize":2567063,"views":106130,"downloads":50570,"collections":1438,"likes":132,"comments":34,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":2391,"pageURL":"https://pixabay.com/photos/apple-diet-female-food-fresh-2391/","type":"photo","tags":"apple, diet, female","previewURL":"https://cdn.pixabay.com/photo/2010/12/13/10/09/apple-2391_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g8c804950b07b4d67406867c101716833c31ef919efddbb1e17fdb41ae46b4dd4f2e4457d0fe9e92ad1ec6273c2590f07_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g2510e3cc731f8f1cd295d64ff79338c601bb8114a1268f3fac4f49d0c669b40d717918bb4227e380003dcdd2f4456e89_1280.jpg","imageWidth":4752,"imageHeight":3168,"imageSize":752002,"views":107427,"downloads":63580,"collections":1288,"likes":268,"comments":36,"user_id":14,"user":"PublicDomainPictures","userImageURL":"https://cdn.pixabay.com/user/2012/03/08/00-13-48-597_250x250.jpg"},{"id":3580560,"pageURL":"https://pixabay.com/photos/apples-fruits-food-vitamins-sliced-3580560/","type":"photo","tags":"apples, fruits, food","previewURL":"https://cdn.pixabay.com/photo/2018/08/02/21/51/apples-3580560_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gcea23df4755060c4cb217fe369f22362bb43182a493d82a180543dd1f9c028ed21fc5864f328c722f1ad57f27e6178f3278132fc6016b7f94b89e12383704d8d_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g2ee72f4be2a3ed41ebf8d972c32c511ec4ed39ffca53fb8b4d80d06bccf782cc9f09f6b62fa4d5432a9d8beca00c0a6a08869a7b4c0b29cf0c753f3ca2129ada_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":3704994,"views":123162,"downloads":91213,"collections":1174,"likes":306,"comments":103,"user_id":6355831,"user":"pasja1000","userImageURL":"https://cdn.pixabay.com/user/2021/02/06/02-19-29-704_250x250.png"},{"id":1368187,"pageURL":"https://pixabay.com/photos/apple-blossom-flowers-tree-1368187/","type":"photo","tags":"apple blossom, flowers, tree","previewURL":"https://cdn.pixabay.com/photo/2016/05/02/22/16/apple-blossom-1368187_150.jpg","previewWidth":150,"previewHeight":88,"webformatURL":"https://pixabay.com/get/ge3280021b5f4c413e2338f70de5ec4bcfbc06054caca95abbc5f4d851e82096fe4d09b860e8ab22ffa3fdba57508b3ee4ae57a4fb18d8c095d663f0a1972b19b_640.jpg","webformatWidth":640,"webformatHeight":379,"largeImageURL":"https://pixabay.com/get/gb67f44c6b4e26918153fb21f062df7f0353754f0b6ac51f9a90b001cf9f328bf748f3478d9fe8d0f7a1daa5ac31a2f21af36f921aaa9be37164d683692d6adff_1280.jpg","imageWidth":3966,"imageHeight":2352,"imageSize":860935,"views":196064,"downloads":118488,"collections":576,"likes":684,"comments":114,"user_id":2367988,"user":"kie-ker","userImageURL":""},{"id":410311,"pageURL":"https://pixabay.com/photos/iphone-hand-screen-smartphone-apps-410311/","type":"photo","tags":"iphone, hand, screen","previewURL":"https://cdn.pixabay.com/photo/2014/08/05/10/27/iphone-410311_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g8ffe44a1a28999a29d8eb666426aabeccdeebccb81a30758984492325abbe336d01d3c08cc6545ed848850c1ecb67985_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g6a789ea736a78c2ac7604a69244e55a30074d210a40451cf51543d436187bd76964fd8741fe823757e4b9d7b8bc48b60188d2ec1bd1e944ac3d8fb931ba42d28_1280.jpg","imageWidth":1920,"imageHeight":1280,"imageSize":416413,"views":506469,"downloads":251179,"collections":618,"likes":593,"comments":159,"user_id":264599,"user":"JESHOOTS-com","userImageURL":"https://cdn.pixabay.com/user/2014/06/08/15-27-10-248_250x250.jpg"},{"id":500291,"pageURL":"https://pixabay.com/photos/iphone-hand-girl-smartphone-500291/","type":"photo","tags":"iphone, hand, girl","previewURL":"https://cdn.pixabay.com/photo/2014/10/23/20/51/iphone-500291_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gae578b671b17e95c50ade23d95cac7547379da95a00348682179dbc1171aaaeee37ed8823e392af91d80fa5658a74bb6_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/gc39b5187060d42313813d7147f9bbb50b44b6390bb754482178b4346989d4bc03c50c183b0574d5d1bf1bd1cc9f60ac3ffb719146338237f14f83d8b34e27d6e_1280.jpg","imageWidth":1920,"imageHeight":1280,"imageSize":521447,"views":153465,"downloads":74402,"collections":1038,"likes":250,"comments":45,"user_id":264599,"user":"JESHOOTS-com","userImageURL":"https://cdn.pixabay.com/user/2014/06/08/15-27-10-248_250x250.jpg"}]}
""";
